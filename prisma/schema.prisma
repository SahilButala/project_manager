// ===================================
// Prisma Client Generator
// ===================================
generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

// ===================================
// Database
// ===================================
datasource db {
  provider = "postgresql"
}

// ===================================
// USER MODEL
// ===================================
model User {
  id           String            @id @default(uuid())
  name         String
  email        String            @unique
  about        String?
  industryType String?
  role         String
  country      String
  image        String?
  workspaces   WorkspaceMember[]
  tasks        Task[]
  activities   Activities[]
  comments     Comment[]
  subscription Subscription?

  onboardingCompleted Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===================================
// WORKSPACE MODEL
// ===================================
model Workspace {
  id          String  @id @default(uuid())
  name        String
  description String?
  ownerId     String?
  inviteCode  String  @unique

  members  WorkspaceMember[]
  projects Project[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===================================
// WORKSPACE MEMBER
// ===================================
enum AccessLevel {
  OWNER
  MEMBER
  VIEWER
}

model WorkspaceMember {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  role        String?
  accessLevel AccessLevel @default(MEMBER)

  projectAccess ProjectAccess[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, workspaceId])
}

// ===================================
// PROJECT MODEL
// ===================================
model Project {
  id          String  @id @default(uuid())
  name        String
  description String?

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  tasks         Task[]
  activities    Activities[]
  comments      Comment[]
  documentation Documentation[]
  projectAccess ProjectAccess[]
  files         File[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([workspaceId, name])
  @@index([workspaceId])
}

// ===================================
// PROJECT ACCESS
// ===================================
model ProjectAccess {
  id String @id @default(uuid())

  workspaceMemberId String
  workspaceMember   WorkspaceMember @relation(fields: [workspaceMemberId], references: [id], onDelete: Cascade)

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  hasAccess Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([workspaceMemberId, projectId])
}

// ===================================
// TASK MODEL
// ===================================
enum TaskStatus {
  TODO
  IN_PROGRESS
  COMPLETED
  IN_REVIEW
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

model Task {
  id          String  @id @default(uuid())
  title       String
  description String?

  status   TaskStatus   @default(TODO)
  priority TaskPriority @default(LOW)

  position Int
  dueDate  DateTime

  assignedId String?
  assignedTo User?   @relation(fields: [assignedId], references: [id], onDelete: SetNull)

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  attachments File[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
}

// ===================================
// ACTIVITY MODEL
// ===================================
model Activities {
  id          String @id @default(uuid())
  type        String
  description String

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([projectId])
  @@index([userId])
}

// ===================================
// COMMENT MODEL
// ===================================
model Comment {
  id      String @id @default(uuid())
  content String

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([userId])
}

// ===================================
// DOCUMENTATION
// ===================================
model Documentation {
  id      String @id @default(uuid())
  content String

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===================================
// FILE MODEL
// ===================================
enum FileType {
  PDF
  IMAGE
}

model File {
  id   String   @id @default(uuid())
  name String
  url  String
  type FileType

  taskId String?
  task   Task?   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([taskId])
  @@index([projectId])
}

// ===================================
// SUBSCRIPTION
// ===================================
enum SubscriptionPlan {
  FREE
  PRO
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAST_DUE
}

model Subscription {
  id String @id @default(uuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  plan   SubscriptionPlan   @default(FREE)
  status SubscriptionStatus @default(ACTIVE)

  lemonsqueezyId String?
  orderId        String?
  customerId     String?

  currentPeriodEnd  DateTime?
  frequency         String    @default("monthly")
  cancelAtPeriodEnd Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
